"use strict";(self.webpackChunkvisdecode_site=self.webpackChunkvisdecode_site||[]).push([[7745],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),c=p(n),u=a,m=c["".concat(s,".").concat(u)]||c[u]||h[u]||i;return n?o.createElement(m,r(r({ref:t},d),{},{components:n})):o.createElement(m,r({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,r[1]=l;for(var p=2;p<i;p++)r[p]=n[p];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},4727:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>c,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var o=n(7462),a=(n(7294),n(3905));const i={slug:"add-tooltip",title:"How to add a tooltip to a line chart",authors:["mehdi"],tags:["tooltip","react","d3","line chart"]},r=void 0,l={permalink:"/visualdecode/blog/add-tooltip",source:"@site/blog/2023-01-22-adding-tooltip.md",title:"How to add a tooltip to a line chart",description:"Introduction",date:"2023-01-22T00:00:00.000Z",formattedDate:"January 22, 2023",tags:[{label:"tooltip",permalink:"/visualdecode/blog/tags/tooltip"},{label:"react",permalink:"/visualdecode/blog/tags/react"},{label:"d3",permalink:"/visualdecode/blog/tags/d-3"},{label:"line chart",permalink:"/visualdecode/blog/tags/line-chart"}],readingTime:6.42,hasTruncateMarker:!1,authors:[{name:"Mehdi Allahyari",title:"Principle Research Scientist",url:"https://github.com/mallahyari",imageURL:"https://github.com/mallahyari.png",key:"mehdi"}],frontMatter:{slug:"add-tooltip",title:"How to add a tooltip to a line chart",authors:["mehdi"],tags:["tooltip","react","d3","line chart"]},prevItem:{title:"Designing Eye-catching Radar Plots with React and D3",permalink:"/visualdecode/blog/beautiful-radar-plot"},nextItem:{title:"Visualizing Data with Line Charts in React and D3",permalink:"/visualdecode/blog/linechart-visualization"}},s={authorsImageUrls:[void 0]},p=[{value:"Introduction",id:"introduction",level:2},{value:"Step 1: Set up the line chart",id:"step-1-set-up-the-line-chart",level:2},{value:"Step 2: Create the tooltip",id:"step-2-create-the-tooltip",level:2},{value:"Step 3: Add event listeners",id:"step-3-add-event-listeners",level:2},{value:"Step 4: Show the tooltip",id:"step-4-show-the-tooltip",level:2},{value:"Step 5: Add the data to the tooltip",id:"step-5-add-the-data-to-the-tooltip",level:2},{value:"Step 6: Add styling",id:"step-6-add-styling",level:2}],d={toc:p};function c(e){let{components:t,...i}=e;return(0,a.kt)("wrapper",(0,o.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"Creating a tooltip for a line chart can be a great way to add interactivity and provide additional information to your data visualization. In this blog post, I will show you how to create a tooltip for a line chart using D3 and React."),(0,a.kt)("h2",{id:"step-1-set-up-the-line-chart"},"Step 1: Set up the line chart"),(0,a.kt)("p",null,"The first step is to set up the line chart. You can use any charting library to create your line chart. You can read my post ",(0,a.kt)("a",{parentName:"p",href:"/visualdecode/blog/linechart-visualization"},"visualizing data with line chart")," and generate the line chart."),(0,a.kt)("h2",{id:"step-2-create-the-tooltip"},"Step 2: Create the tooltip"),(0,a.kt)("p",null,"The next step is to create the tooltip. We can use third party libraries such as ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ReactTooltip/react-tooltip"},"react-tooltip"),", yet again where will be the fun of it?! All jokes aside, our goal here is to learn how to create our own custom tooltip for our visualizations. Nevertheless, in future we will use some existing libraries. You can create a new ",(0,a.kt)("inlineCode",{parentName:"p"},"div")," element for the tooltip and give it an initial position, such as ",(0,a.kt)("inlineCode",{parentName:"p"},"display: 'none'"),", to hide it initially. You can then use React state to keep track of whether or not the tooltip should be displayed."),(0,a.kt)("p",null,"Our tooltip needs some basic CSS properties like initial positioning, background color, etc. I create a ",(0,a.kt)("inlineCode",{parentName:"p"},"styles.css")," file and defined the following properties:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},"#wrapper {\n  position: relative;\n}\ntooltip {\n  opacity: 1;\n  position: absolute;\n  top: 0;\n  left: 0;\n  padding: 0.3em 1em;\n  background: #fff;\n  text-align: center;\n  border: 1px solid #ddd;\n  z-index: 10;\n  transition: all 0.2s ease-out;\n  /* Prevent tooltip from receiving the mouse events we will be implementing */\n  pointer-events: none;\n}\n\n/* Adds an arrow pointing down at the hovered bar */\n.tooltip:before {\n  content: '';\n  position: absolute;\n  bottom: 0;\n  left: 50%;\n  width: 12px;\n  height: 12px;\n  background: white;\n  border: 1px solid #ddd;\n  border-top-color: transparent;\n  border-left-color: transparent;\n  transform: translate(-50%, 50%) rotate(45deg);\n  transform-origin: center center;\n  z-index: 10;\n}\n")),(0,a.kt)("p",null,"In order for our toolip to work properly, it must have an absolute position (",(0,a.kt)("inlineCode",{parentName:"p"},"position: absolute"),") and its parent container (",(0,a.kt)("inlineCode",{parentName:"p"},"div")," with id of ",(0,a.kt)("inlineCode",{parentName:"p"},"wrapper"),") needs to have a relative position (",(0,a.kt)("inlineCode",{parentName:"p"},"position: relative"),"). ",(0,a.kt)("inlineCode",{parentName:"p"},".tooltip:before")," pseudo-selector will add an arrow pointing down at the hovered point. Also ",(0,a.kt)("inlineCode",{parentName:"p"},"pointer-events: none")," prevents the tootip from stealing to mouse events as we'll add the events to our line and not the tooltip. The snippet below partially shows the ",(0,a.kt)("inlineCode",{parentName:"p"},"linechart.js")," along with our tooltip component:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'<div id="wrapper">\n  <svg width={width} height={height} style={{ backgroundColor: \'#F5F3F2\' }}>\n    // line chart code\n  </svg>\n  <div className="tooltip">\n    <div>Date:</div>\n    <div>Price:</div>\n  </div>\n</div>\n')),(0,a.kt)("p",null,"Toolitp is positioned in the top left of our ",(0,a.kt)("inlineCode",{parentName:"p"},"wrapper")," div.\n",(0,a.kt)("img",{alt:"tooltip-initial",src:n(7999).Z,width:"813",height:"415"})),(0,a.kt)("h2",{id:"step-3-add-event-listeners"},"Step 3: Add event listeners"),(0,a.kt)("p",null,"To make the tooltip interactive, you need to add event listeners to the line chart. You can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"onMouseMove")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"onMouseLeave")," events to detect when the user hovers over the line chart. However, instead of catching hover events for individual points of the line chart, we want to show a tooltip whenever a user is hovering anywhere on the chart. Therefore, we need to cover the entire bounding box of the line chart. To make that happen, we have to create a ",(0,a.kt)("inlineCode",{parentName:"p"},"<rect>")," that spans our bounding box and add mouse event listeners to it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'<rect\n  width={boundedDimensions.width}\n  height={boundedDimensions.height}\n  fill="transparent"\n  onMouseMove={(e) => handleMouseMove(e)}\n  onMouseLeave={handleMouseLeave}\n/>\n')),(0,a.kt)("p",null,"Please note that we don't need to specify the ",(0,a.kt)("inlineCode",{parentName:"p"},"x")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"y")," attributes since they both default to 0. Also we have to set ",(0,a.kt)("inlineCode",{parentName:"p"},"<rect>"),"'s ",(0,a.kt)("inlineCode",{parentName:"p"},"fill")," property to ",(0,a.kt)("inlineCode",{parentName:"p"},"transparent"),", otherwise we will see a black rectangle covering the whole chart."),(0,a.kt)("h2",{id:"step-4-show-the-tooltip"},"Step 4: Show the tooltip"),(0,a.kt)("p",null,"When the user hovers anywhere over the line chart, we can use React state to update the position and visibility of the tooltip."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"// Tooltip data\nconst [tooltipData, setTooltipData] = useState({});\n\n// Flag to control whether to show or hide tooltip\nconst [showTooltip, setShowTooltip] = useState(false);\n\n// x, y postion of closest point for drawing a circle\n// around the point on the chart\nconst [xPos, setXPos] = useState(0);\nconst [yPos, setYPos] = useState(0);\n")),(0,a.kt)("p",null,"Although we can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"event.clientX")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"event.clientY")," properties to get the current mouse position directly, we'd rather use ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/d3/d3-selection/blob/main/README.md#pointer"},"d3.pointer()")," to transform the event position to the local coordinate system of the element that received the event. And use that position to set the tooltip's position."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const handleMouseMove = (e) => {\n  const mouseXYPos = d3.pointer(e);\n  console.log(mouseXYPos);\n};\n\n// Example of mouse position as an [x, y] array in\n// the console output while moving the mouse\n[689, 284];\n")),(0,a.kt)("h2",{id:"step-5-add-the-data-to-the-tooltip"},"Step 5: Add the data to the tooltip"),(0,a.kt)("p",null,"When the user hovers over the line chart, we can use the data associated with that point to update the tooltip. We can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"d3.bisector()")," function to find the closest point on the line chart to the current mouse position and then use the data associated with that point to update the tooltip. To find the closes point, we can use the x position of the ",(0,a.kt)("inlineCode",{parentName:"p"},"mouseXYPos")," point. Then using our ",(0,a.kt)("inlineCode",{parentName:"p"},"xScale.invert()")," function, we convert from ",(0,a.kt)("inlineCode",{parentName:"p"},"range")," (i.e. pixels) to the ",(0,a.kt)("inlineCode",{parentName:"p"},"domain")," (i.e. dates in our dataset)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const xPos = mouseXYPos[0];\nconst hoveredDate = xScale.invert(xPos);\n")),(0,a.kt)("p",null,"Next, we have to find the closest data point, i.e. the data point with the ",(0,a.kt)("em",{parentName:"p"},"closest date"),", in our dataset that this ",(0,a.kt)("inlineCode",{parentName:"p"},"hoveredDate"),". We can define a function that computes the distance via some ",(0,a.kt)("em",{parentName:"p"},"comparator")," between two adjacent items. We run that for all the items in the dataset, and find the index of the item with least distance. However, d3 comes to save us by providing these many utility functions including one for this purpose. ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/d3/d3-array"},"d3.bisector(accessor/comparator)")," returns a new bisector using the specified ",(0,a.kt)("em",{parentName:"p"},"accessor")," or ",(0,a.kt)("em",{parentName:"p"},"comparator")," function. In other words, it returns the insertion point for x in ",(0,a.kt)("em",{parentName:"p"},"array")," to maintain sorted order. If x is already present in array, the insertion point will be before (to the left of) or after (to the right) any existing entries depending on if we choose ",(0,a.kt)("inlineCode",{parentName:"p"},"bisectLeft")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"bisectRight"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const bisectDate = d3.bisector((d) => xAccessor(d)).right;\nconst closestIndex = bisectDate(data, hoveredDate);\n")),(0,a.kt)("p",null,"We have the index of the closest point, so we can easily"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"retrieve the corresponding data item"),(0,a.kt)("li",{parentName:"ul"},"calculate the position of the tooltip to be displayed"),(0,a.kt)("li",{parentName:"ul"},"update the tooltip data and React state")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},"const closestDataPoint = data[closestIndex];\nconst closestXValue = xAccessor(closestDataPoint);\nconst closestYValue = yAccessor(closestDataPoint);\nconst newTooltipData = {\n  data: closestDataPoint,\n  x: xScale(closestXValue) + dimensions.margin.left,\n  y: yScale(closestYValue),\n};\nsetTooltipData(newTooltipData);\nsetShowTooltip(true);\nsetXPos(() => xScale(closestXValue));\nsetYPos(() => yScale(closestYValue));\n")),(0,a.kt)("p",null,"In addition to the tooltip, I added a vertical line ",(0,a.kt)("inlineCode",{parentName:"p"},"<line>"),", and a ",(0,a.kt)("inlineCode",{parentName:"p"},"<circle>")," to make the toolip more readable."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'  <circle\n    cx={xPos}\n    cy={yPos}\n    r="3"\n    fill="white"\n    stroke="#BD2D28"\n    strokeWidth="2"\n    pointerEvents="none"\n  />\n  <line\n    x1={xPos}\n    y1={0}\n    x2={xPos}\n    y2={boundedDimensions.height}\n    stroke="#0F8C79"\n    strokeWidth="2"\n    strokeDasharray="5,4"\n    pointerEvents="none"\n  />\n')),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"tooltip",src:n(8258).Z,width:"824",height:"420"})),(0,a.kt)("h2",{id:"step-6-add-styling"},"Step 6: Add styling"),(0,a.kt)("p",null,"We can use CSS to style the tooltip and make it look more attractive. I simply added a few CSS properties in the ",(0,a.kt)("inlineCode",{parentName:"p"},"styles.css")," to make the tooltip slightly more appealing."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},".tooltip-info {\n  font-size: 12px;\n  text-align: left;\n}\n.tooltip p {\n  margin-top: 5px;\n  margin-bottom: 5px;\n}\n")),(0,a.kt)("p",null,"Additionally, I refactored the code a bit and created a separate component for the tooltip."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-javascript"},'const Tooltip = ({ tooltipData }) => {\n  const { data } = tooltipData;\n  return (\n    <div\n      className="tooltip"\n      style={{\n        transform: `translate(calc(-50% + ${tooltipData.x}px), calc(-100% + ${tooltipData.y}px))`,\n      }}\n    >\n      <div className="tooltip-info">\n        <p>\n          <strong>Date: </strong>\n          {data.Date}\n        </p>\n        <p>\n          <strong>Price: </strong> {Number.parseFloat(data.Close).toFixed(2)}\n        </p>\n      </div>\n    </div>\n  );\n};\n')),(0,a.kt)("p",null,"Here's our final tooltip:\n",(0,a.kt)("img",{alt:"final tooltip",src:n(5644).Z,width:"815",height:"439"})),(0,a.kt)("p",null,"In summary, adding a tooltip to a line chart is a great way to make your data visualization more interactive and informative. With the help of React, you can easily create a tooltip that displays additional information when a user hovers over a specific point. You can find the code in this ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/mallahyari/vis-react-d3"},"Github repo"),"."))}c.isMDXComponent=!0},5644:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/linechart-tooltip-b8ccc58193f4b66ec0807ff320bda78e.gif"},8258:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/tooltip-final-bdc9a28a4d5491b25d3468b9c9585483.png"},7999:(e,t,n)=>{n.d(t,{Z:()=>o});const o=n.p+"assets/images/tooltip-initial-fbbdb833f5a2b2203052ccd6894e2a0f.png"}}]);